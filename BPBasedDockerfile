# this image mimics cuda install on buildpack-deps base. 
# previous verions mimicked buildpack-deps on a cudagl base, but nvidia has
# at least temporariliy suspended publishing images.

FROM buildpack-deps:22.04 as base

# environment variables
ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=UTC
ENV LANG=en_US.UTF-8
ENV PASSWORD password
ENV SHELL=/bin/bash
ENV WORKSPACE=/tmp/workspace/buildpack-deps-cuda
# nvidia-container-runtime

# this may not be necessary but may give insight on source files
COPY . ${WORKSPACE}/

## maybe this method?
# https://developer.nvidia.com/cuda-downloads?target_os=Linux&target_arch=x86_64&Distribution=Ubuntu&target_version=22.04&target_type=deb_network

RUN wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-keyring_1.0-1_all.deb && \
    dpkg -i cuda-keyring_1.0-1_all.deb && \
    apt-get update && \
    apt-get -y install \
    cuda

ENV PATH=/usr/local/cuda-11.7/bin${PATH:+:${PATH}}
# nvidia-container-runtime
ENV NVIDIA_VISIBLE_DEVICES all
ENV NVIDIA_DRIVER_CAPABILITIES compute,utility

